{% extends 'master_page.html' %}
{% load static %}
{% block title %}Edit Profile{% endblock %}

{% block content %}
<div class="container py-5">
    <div class="card shadow-lg border-0" style="border-radius: 12px;">

        <div class="card-header bg-primary text-white p-4" style="border-radius: 12px 12px 0 0;">
            <h3 class="fw-bold m-0 d-flex align-items-center">
                <i class="bi bi-person-circle me-3"></i> Profile Settings
            </h3>
        </div>

        <div class="card-body p-4 p-md-5">
            <form method="POST" enctype="multipart/form-data" novalidate>
                {% csrf_token %}

                <div class="row g-4">
                    <div class="col-lg-4 text-center border-end">
                        <h5 class="fw-bold text-primary mb-3">Profile Picture</h5>

                        <div class="d-inline-block position-relative mb-3">
                            {% if user.profile.profile_picture %}
                                <img src="{{ user.profile.profile_picture.url }}" 
                                     alt="Profile Picture" 
                                     width="150" height="150" 
                                     class="rounded-circle shadow-sm border border-3 border-light" 
                                     style="object-fit: cover;">
                                
                                <a href="{% url 'accounts:delete_profile_picture' %}" 
                                   class="btn btn-sm btn-outline-danger position-absolute" 
                                   data-bs-toggle="tooltip" data-bs-placement="top" title="Delete Profile Picture"
                                   style="top: 0; right: 0; padding: 0.1rem 0.5rem; border-radius: 50%;">
                                    <i class="bi bi-x"></i>
                                </a>
                            {% else %}
                                <div class="bg-light rounded-circle border border-1 border-secondary d-flex justify-content-center align-items-center mx-auto" style="width: 150px; height: 150px;">
                                    <i class="bi bi-person-fill" style="font-size: 4rem; color: #6c757d;"></i>
                                </div>
                            {% endif %}
                        </div>

                        <div class="mb-3">
                            <label class="form-label text-muted">Upload New Picture</label>
                            {{ form.profile_picture }}
                            {% if form.profile_picture.errors %}
                                <small class="text-danger d-block mt-1">{{ form.profile_picture.errors.0 }}</small>
                            {% endif %}
                        </div>
                    </div>

                    <div class="col-lg-8">
                        
                        <h5 class="fw-bold text-primary border-bottom pb-2 mb-3">Personal Information</h5>
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label class="form-label fw-bold text-dark">Full Name</label>
                                {{ form.full_name }}
                                {% if form.full_name.errors %}
                                    <small class="text-danger d-block mt-1">{{ form.full_name.errors.0 }}</small>
                                {% endif %}
                            </div>

                            <div class="col-md-6 mb-3">
                                <label class="form-label fw-bold text-dark">Gender</label>
                                {{ form.gender }}
                            </div>

                            <div class="col-md-6 mb-3">
                                <label class="form-label fw-bold text-dark">Date of Birth</label>
                                {{ form.date_of_birth }}
                                {% if form.date_of_birth.errors %}
                                    {% for error in form.date_of_birth.errors %}
                                        <small class="text-danger d-block mt-1">{{ error }}</small>
                                    {% endfor %}
                                {% endif %}
                            </div>

                            <div class="col-md-6 mb-3">
                                <label class="form-label fw-bold text-dark">DOB Visibility</label>
                                {{ form.dob_visibility }}
                            </div>
                        </div>

                        <h5 class="fw-bold text-primary border-bottom pb-2 mt-4 mb-3">Contact & Location</h5>
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label class="form-label fw-bold text-dark">Phone Number</label>
                                {{ form.phone_number }}
                                {% if form.phone_number.errors %}
                                    <small class="text-danger d-block mt-1">{{ form.phone_number.errors.0 }}</small>
                                {% endif %}
                            </div>

                            <div class="col-md-6 mb-3">
                                <label class="form-label fw-bold text-dark">Phone Visibility</label>
                                {{ form.phone_visibility }}
                            </div>
                            
                            <div class="col-12 mb-3">
                                <label class="form-label fw-bold text-dark">Address</label>
                                {{ form.address }}
                            </div>
                        </div>

                        <h5 class="fw-bold text-primary border-bottom pb-2 mt-4 mb-3">Bio & Social Links</h5>
                        <div class="row">
                            <div class="col-12 mb-3">
                                <label class="form-label fw-bold text-dark">Bio (A short summary about yourself)</label>
                                {{ form.bio }}
                                {% if form.bio.errors %}
                                    <small class="text-danger d-block mt-1">{{ form.bio.errors.0 }}</small>
                                {% endif %}
                            </div>
                            
                            <div class="col-md-6 mb-3">
                                <label class="form-label fw-bold text-dark">Website</label>
                                {{ form.website }}
                            </div>

                            <div class="col-md-6 mb-3">
                                <label class="form-label fw-bold text-dark">LinkedIn</label>
                                {{ form.linkedin }}
                            </div>

                            <div class="col-md-6 mb-3">
                                <label class="form-label fw-bold text-dark">Twitter</label>
                                {{ form.twitter }}
                            </div>
                        </div>

                    </div>
                </div>

                <div class="text-center">
                    <button type="submit" 
                        class="btn btn-primary mt-5 px-4"
                        style="border-radius: 6px; font-weight: bold; background: linear-gradient(45deg, #0d6efd, #0b5ed7); border: none; padding: 0.5rem 1rem !important;">
                        <i class="bi bi-save me-2"></i> Save Changes
                    </button>
                </div>
                
            
            </form>
        </div>
    </div>
</div>

<style>
    /* Import Google Fonts and Bootstrap Icons for a professional look */
    @import url('https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap');
    @import url("https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css");

    body {
        background-color: #f8f9fa; /* Light grey/off-white background */
        font-family: 'Roboto', sans-serif;
    }

    /* Core Input/Select/Textarea Styling */
    input:not([type="checkbox"]):not([type="radio"]), select, textarea {
        border-radius: 4px;
        border: 1px solid #ced4da;
        padding: 0.375rem 0.75rem !important;
        line-height: 1.5;
        font-size: 1rem;
        transition: border-color 0.15s ease-in-out, box-shadow 0.15s ease-in-out;
        width: 100%; /* Make inputs full width within their column */
        height: auto !important; /* Reset height for proper padding */
    }

    textarea {
        min-height: 80px; /* Allow more space for bio */
        resize: vertical;
    }

    input:focus, select:focus, textarea:focus {
        border-color: #0d6efd;
        box-shadow: 0 0 0 0.25rem rgba(13, 110, 253, 0.25);
    }
    
    /* Make Django fields render as Bootstrap form-control */
    .form-label + input, .form-label + select, .form-label + textarea {
        display: block; /* Ensure full width */
    }

    /* File Input Specific Adjustments */
    input[type="file"] {
        padding: 0.375rem 0.75rem !important;
        height: auto !important;
    }
    
    /* Profile Picture Delete Button Position */
    .position-absolute {
        z-index: 10;
        background-color: white;
        border: 1px solid #dc3545;
    }

    /* Small Screen Adjustments for Picture Delete Button */
    @media (max-width: 991.98px) {
        .border-end {
            border-bottom: 1px solid #dee2e6 !important;
            border-right: none !important;
            padding-bottom: 1.5rem;
        }
    }
    
</style>

<script>
    document.addEventListener('DOMContentLoaded', function () {
        var tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'))
        var tooltipList = tooltipTriggerList.map(function (tooltipTriggerEl) {
            return new bootstrap.Tooltip(tooltipTriggerEl)
        })
    });
</script>
{% endblock %}